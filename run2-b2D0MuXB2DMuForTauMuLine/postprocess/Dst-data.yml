b0dst:
    headers:
        user:
            - functor/basic.h
            - functor/particle.h
    input_tree: TupleB0/DecayTree
    rename:
        # Event uid
        runNumber: run
        eventNumber: event
        GpsTime: time
        # Isolation variables
        Y_ISOLATION_BDT: iso_bdt
        # Particles
        D0_ID: D0_id
        piminus_ID: piplus_id
        muplus_ID: muminus_id
        Y_M: B0_m
    calculation:
        # PID
        Dst_idprod: "Double_t;PROD(D0_ID, piminus_ID)"  # - for a physical process
        B0_idprod: "Double_t;PROD(D0_ID, muplus_ID)"    # +
        _muminus_pid: "^Bool_t;MU_PID(muplus_isMuon, muplus_PIDmu)"
        muminus_pid: "Bool_t;_muminus_pid"
        # Other flags
        _isdata: "^Bool_t;ISDATA(GpsTime)"
        isdata: "Bool_t;_isdata"
        # Transient variables for missing mass calculation
        _flight: "^TVector3;VEC_DELTA(Y_ENDVERTEX_X, Y_ENDVERTEX_Y, Y_ENDVERTEX_Z, Y_OWNPV_X, Y_OWNPV_Y, Y_OWNPV_Z)"
        _Dst_p: "^TLorentzVector;FOUR_VEC(Dst_2010_minus_PX, Dst_2010_minus_PY, Dst_2010_minus_PZ, Dst_2010_minus_PE)"
        _B0_p_est: "^TLorentzVector;P_EST(Y_PZ, Y_M, _flight)"
        # Alternative (Unofficial) missing mass calculation
        _q2_alt: "^Double_t;M2(_B0_p_est-_Dst_p)"
        _m2miss_alt: "^Double_t;M2(_B0_p_est - FOUR_VEC(Y_PX, Y_PY, Y_PZ, Y_PE))"
        # Fill these variables in the tree
        m2miss_alt: "Double_t;GEV2(_m2miss_alt)"
        q2_alt: "Double_t;GEV2(_q2_alt)"
        # Missing mass variables that come with the ntuple
        m2miss: "Double_t;GEV2(FitVar_Mmiss2)"
        q2: "Double_t;GEV2(FitVar_q2)"
        el: "Double_t;GEV(FitVar_El)"
        # See if these two methods agree
        m2miss_diff: "Double_t;GEV2(SUB(FitVar_Mmiss2, _m2miss_alt))"
        q2_diff: "Double_t;GEV2(SUB(FitVar_q2, _q2_alt))"
    selection:
        - "_muminus_pid"
        - "&&"
        - "(Y_ISOLATION_BDT < 0.15)"
        - "&&"
        - "_isdata"
        - "&&"
        - "(Y_M < 5280)"
        # L0 cuts
        - "&&"
        - "(Y_L0Global_TIS || Dst_2010_minus_L0HadronDecision_TOS)"
        - "&&"
        - "muplus_L0Global_TIS"
